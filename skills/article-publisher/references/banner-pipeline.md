# Banner Pipeline Reference

## Overview

Generates branded 5:2 ratio banners (1250Ã—500) using a hybrid approach:
**fal.ai** for the abstract visual background + **HTML/CSS + Playwright** for text overlay.

## Why This Approach

### Failed approaches (don't repeat these):

1. **ImageMagick text rendering** â€” Can't render macOS system fonts (missing Ghostscript). Text looks terrible with fallback fonts. Dead end on macOS.

2. **Pure fal.ai with text in prompt** â€” AI-generated text is unreliable. Letters get garbled, spacing is wrong, can't match brand fonts. Never use AI to generate text.

3. **Canvas API / Node.js** â€” Works but requires installing canvas native dependencies (cairo, pango). Heavy setup for a simple banner.

### What works:

**HTML/CSS + Playwright screenshot.** Full control over typography (Google Fonts), pixel-perfect layout, easy to template and parameterize. Playwright's screenshot is fast and reliable.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  fal.ai Flux    â”‚     â”‚  ffmpeg       â”‚     â”‚  HTML Template    â”‚
â”‚  (abstract bg)  â”‚ â”€â”€â–¶ â”‚  (5:2 crop)  â”‚ â”€â”€â–¶ â”‚  (text overlay)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                               â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                               â”‚  Playwright  â”‚
                                               â”‚  screenshot  â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                               â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                               â”‚  banner.png  â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Design Language

- **Background:** #0a0a0a (near-black)
- **Accent:** #4ade80 (muted green) â€” used for tags, pipeline steps, top border
- **Text:** #f0f0f0 (off-white) for titles, rgba(255,255,255,0.55) for subtitles
- **Fonts:** Inter (headings, body), JetBrains Mono (stats, code, tags)
- **Style:** Bloomberg Ã— Apple aesthetic â€” no neon, no glow, no gradients except the left-dark overlay
- **Gradient overlay:** Dark left (opacity 0.97) â†’ transparent right â€” ensures text is always readable regardless of background image

## Template Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `{{TITLE}}` | Main title | "Ship Log: Week 3" |
| `{{SUBTITLE}}` | Secondary text | "Autonomous infrastructure report" |
| `{{TAG}}` | Top label (uppercase) | "AUTONOMOUS INFRASTRUCTURE" |
| `{{BG_IMAGE}}` | Background image URL/path | "file:///tmp/bg.png" |
| `{{STATS_HTML}}` | Pre-built stats HTML | Generated by script |
| `{{PIPELINE_HTML}}` | Pre-built pipeline HTML | Generated by script |
| `{{BRAND}}` | Bottom-right brand text | "Axiom ğŸ”¬" |

## Stats Format

Pass stats as comma-separated `Label:Value` pairs:

```
--stats "Transactions:1,057,Uptime:14 days,Bugs Lost:$0,Burned:935M AXIOM"
```

Each pair becomes a stat block with the value on top (large, bold) and label below (small, muted).

## Pipeline Format

Pass pipeline steps as comma-separated names:

```
--pipeline "REBALANCE,COMPOUND,HARVEST,BURN"
```

Rendered as bordered pills with arrows between them.

## Dependencies

- **Node.js** with `npx` (for Playwright)
- **Playwright** chromium browser (`npx playwright install chromium`)
- **ffmpeg** (for cropping fal.ai output to 5:2 ratio)
- **curl** (for fal.ai API calls)
- **FAL_API_KEY** in `~/.axiom/wallet.env` (only if using --prompt, not needed with --bg-image)
